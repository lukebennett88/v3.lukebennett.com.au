---
import { MoonIcon } from '~/components/icons/moon';
import { SunIcon } from '~/components/icons/sun';
import { cn } from '~/lib/cn';
import { packs } from '~/lib/packs';
---

<div class="flex flex-1 justify-end gap-4">
	<button
		id="theme-toggle"
		class={cn(
			'flex h-9 w-9 items-center justify-center rounded-full dark:text-white',
			packs.focusVisible,
		)}
	>
		<SunIcon className="h-4 w-4 dark:hidden" />
		<MoonIcon className="hidden h-4 w-4 dark:block" />
		<span class="sr-only">Change theme</span>
	</button>

	<script is:inline>
		const theme = (() => {
			if (
				typeof localStorage !== 'undefined' &&
				localStorage.getItem('theme')
			) {
				return localStorage.getItem('theme');
			}
			if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
				return 'dark';
			}
			return 'light';
		})();

		if (theme === 'light') {
			document.documentElement.classList.remove('dark');
		} else {
			document.documentElement.classList.add('dark');
		}

		window.localStorage.setItem('theme', theme);

		const handleToggleClick = () => {
			const element = document.documentElement;
			element.classList.toggle('dark');

			const isDark = element.classList.contains('dark');
			localStorage.setItem('theme', isDark ? 'dark' : 'light');
		};

		document
			.getElementById('theme-toggle')
			.addEventListener('click', handleToggleClick);
	</script>
</div>
